import{_ as i,r,o as c,c as d,a as s,b as e,d as n,w as l,e as o}from"./app.469183e7.js";const t={},p=o('<h1 id="\u73AF\u5883\u642D\u5EFA-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u642D\u5EFA-\u914D\u7F6E" aria-hidden="true">#</a> \u73AF\u5883\u642D\u5EFA &amp;&amp; \u914D\u7F6E</h1><h2 id="\u73AF\u5883\u642D\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u642D\u5EFA" aria-hidden="true">#</a> \u73AF\u5883\u642D\u5EFA</h2><h3 id="minikube\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#minikube\u96C6\u7FA4" aria-hidden="true">#</a> Minikube\u96C6\u7FA4</h3><p>\u5355\u8282\u70B9Kubernetes\u73AF\u5883\uFF0C\u5E38\u7528\u4E8E\u5B66\u4E60\u4F7F\u7528\u6216\u4F5C\u4E3A\u5F00\u53D1\u73AF\u5883\u3002</p>',4),u=s("h3",{id:"kubernetes\u96C6\u7FA4",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#kubernetes\u96C6\u7FA4","aria-hidden":"true"},"#"),e(" Kubernetes\u96C6\u7FA4")],-1),b=s("p",null,"\u4E00\u4E2AMaster\u8282\u70B9\u548C\u82E5\u5E72Worker\u8282\u70B9\u7EC4\u6210\uFF0C\u5E38\u7528\u4E8E\u5F00\u53D1\u6216\u6D4B\u8BD5\u73AF\u5883\u3002",-1),h=s("h3",{id:"kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4","aria-hidden":"true"},"#"),e(" Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4")],-1),D=s("p",null,"\u81F3\u5C113\u4E2AMaster\u8282\u70B9\u548C\u82E5\u5E72Worker\u8282\u70B9\u7EC4\u6210\uFF0C\u5E38\u7528\u4E8E\u6D4B\u8BD5\u6216\u751F\u4EA7\u73AF\u5883\u3002",-1),m=o(`<h2 id="\u73AF\u5883\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u914D\u7F6E" aria-hidden="true">#</a> \u73AF\u5883\u914D\u7F6E</h2><h3 id="\u8BBE\u7F6Enode\u8282\u70B9\u89D2\u8272" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6Enode\u8282\u70B9\u89D2\u8272" aria-hidden="true">#</a> \u8BBE\u7F6ENode\u8282\u70B9\u89D2\u8272</h3><ul><li>\u5C06\u8282\u70B9\u89D2\u8272\u8BBE\u7F6E\u4E3A<code>Master</code>\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubectl label nodes </span><span style="color:#9CDCFE;">$NodeName</span><span style="color:#D4D4D4;"> node-role.kubernetes.io/master=</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>\u5C06\u8282\u70B9\u89D2\u8272\u8BBE\u7F6E\u4E3A<code>Worker</code>\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubectl label nodes </span><span style="color:#9CDCFE;">$NodeName</span><span style="color:#D4D4D4;"> node-role.kubernetes.io/node=</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u4E3A\u8282\u70B9\u8BBE\u7F6E\u6C61\u70B9" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u8282\u70B9\u8BBE\u7F6E\u6C61\u70B9" aria-hidden="true">#</a> \u4E3A\u8282\u70B9\u8BBE\u7F6E\u6C61\u70B9</h3><ul><li>\u4E3A<code>Master</code>\u8282\u70B9\u8BBE\u7F6E\u6C61\u70B9\uFF0C\u4ECE\u800C\u5DE5\u4F5C\u8D1F\u8F7D<code>Pod</code>\u4E0D\u4F1A\u88AB\u8C03\u5EA6\u5230\u8BE5<code>Master</code>\u8282\u70B9\u4E0A\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubectl taint nodes </span><span style="color:#9CDCFE;">$NodeName</span><span style="color:#D4D4D4;"> node-role.kubernetes.io/master=:NoSchedule</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>\u79FB\u9664<code>Master</code>\u8282\u70B9\u7684\u6C61\u70B9\uFF0C\u4ECE\u800C\u5DE5\u4F5C\u8D1F\u8F7D<code>Pod</code>\u5141\u8BB8\u88AB\u8C03\u5EA6\u5230\u8BE5<code>Master</code>\u8282\u70B9\u4E0A\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubectl taint nodes </span><span style="color:#9CDCFE;">$NodeName</span><span style="color:#D4D4D4;"> node-role.kubernetes.io/master-</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u914D\u7F6Ekubeconfig" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6Ekubeconfig" aria-hidden="true">#</a> \u914D\u7F6EKubeconfig</h3><p>\u4ECE<code>Master</code>\u8282\u70B9\u7684<code>/etc/kubernetes/admin.conf</code>\u590D\u5236\u5230\u76EE\u7684\u8282\u70B9\u4E0A\u7684$kubeconfigPath\uFF0C\u7136\u540E\u53C2\u8003\u4EE5\u4E0B\u811A\u672C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">mkdir -p </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube</span></span>
<span class="line"><span style="color:#D4D4D4;">sudo cp -i </span><span style="color:#9CDCFE;">$kubeconfigPath</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube/config</span></span>
<span class="line"><span style="color:#D4D4D4;">sudo chown </span><span style="color:#CE9178;">$(id -u)</span><span style="color:#D4D4D4;">:</span><span style="color:#CE9178;">$(id -g)</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube/config</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684token" tabindex="-1"><a class="header-anchor" href="#\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684token" aria-hidden="true">#</a> \u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684Token</h3><p>\u5728Kubernetes\u96C6\u7FA4\u4E2D\u6DFB\u52A0\u8282\u70B9\u65F6\u901A\u5E38\u9700\u8981\u4F7F\u7528<code>token</code>.</p><p>\u5982\u679Ctoken\u8FC7\u671F\uFF0C\u5728Master\u8282\u70B9\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u91CD\u65B0\u751F\u6210join\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubeadm token create --print-join-command</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684certificate" tabindex="-1"><a class="header-anchor" href="#\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684certificate" aria-hidden="true">#</a> \u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684Certificate</h3><p>\u5728\u9AD8\u53EF\u7528\u96C6\u7FA4\u4E2D\u6DFB\u52A0Master\u8282\u70B9\u65F6\u901A\u5E38\u9700\u8981\u4F7F\u7528<code>certificate-key</code>.</p><p>\u8BE5\u53C2\u6570\u4E3A\u9AD8\u53EF\u7528\u96C6\u7FA4\u521D\u59CB\u5316\u65F6\u751F\u6210\uFF0C\u6709\u6548\u671F\u4E3A2h.</p><p>\u5982\u679C\u8D85\u8FC7\u4E862h, \u5219\u9700\u8981\u5728\u96C6\u7FA4\u4E2D\u7684Master\u8282\u70B9\u4E0A\u6267\u884C\u5982\u4E0B\u6307\u4EE4\u4EE5\u83B7\u53D6\u65B0\u7684<code>certificate-key</code>\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubeadm init phase upload-certs --upload-certs</span></span>
<span class="line"><span style="color:#6A9955;"># \u63A7\u5236\u53F0\u8F93\u51FA\u5982\u4E0B\uFF1A</span></span>
<span class="line"><span style="color:#D4D4D4;">[upload-certs] Storing the certificates </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> Secret </span><span style="color:#CE9178;">&quot;kubeadm-certs&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> the </span><span style="color:#CE9178;">&quot;kube-system&quot;</span><span style="color:#D4D4D4;"> Namespace</span></span>
<span class="line"><span style="color:#D4D4D4;">[upload-certs] Using certificate key:</span></span>
<span class="line"><span style="color:#D4D4D4;">c5ceaa8176d17134605de804914c9d818a956b5248e209dd88e1befc6a3ba605</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u66F4\u6539kubelet\u5DE5\u4F5C\u8DEF\u5F84" tabindex="-1"><a class="header-anchor" href="#\u66F4\u6539kubelet\u5DE5\u4F5C\u8DEF\u5F84" aria-hidden="true">#</a> \u66F4\u6539Kubelet\u5DE5\u4F5C\u8DEF\u5F84</h3><p>\u5728Kubernetes\u73AF\u5883\u4E2D\uFF0C<code>Pod</code>\u7684\u5377\u3001\u65E5\u5FD7\u548C\u5176\u4ED6\u4E00\u4E9B\u4FE1\u606F\u5C06\u5B58\u50A8\u5728\u8282\u70B9\u7684<code>Kubelet</code>\u5DE5\u4F5C\u8DEF\u5F84\u4E2D\u3002</p><p>\u5728Kubernetes\u8282\u70B9\u4E0A\uFF0C\u9ED8\u8BA4\u7684<code>Kubelet</code>\u5DE5\u4F5C\u8DEF\u5F84\u662F<code>/var/lib/kubelet</code>\uFF0C\u5982\u679C\u8BE5\u8DEF\u5F84\u6240\u5728\u78C1\u76D8\u6BD4\u8F83\u5C0F\uFF0C\u5219\u4E0D\u80FD\u8FD0\u884C\u5F88\u591A<code>Pod</code>\u3002\u5982\u679C\u9700\u8981\u5C06\u5176\u4FEE\u6539\u4E3A\u5176\u4ED6\u8DEF\u5F84(\u5982<code>/home/k8s/kubelet</code>)\uFF0C\u5219\u53EF\u53C2\u7167\u4EE5\u4E0B\u6B65\u9AA4\uFF1A</p><ul><li><strong>\u6B65\u9AA4\u4E00</strong> \u7F16\u8F91<code>kubeadm.conf</code>,\u5C06<code>root-dir</code>\u6807\u5FD7\u6DFB\u52A0\u5230\u73AF\u5883\u4E2D\uFF1A</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">vim /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># find the Environment KUBELET_CONFIG_ARGS and add flag --root-dir=/home/k8s/kubelet</span></span>
<span class="line"><span style="color:#D4D4D4;">Environment=</span><span style="color:#CE9178;">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml --root-dir=/home/k8s/kubelet&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u6B65\u9AA4\u4E8C</strong> \u91CD\u65B0\u52A0\u8F7D\u5B88\u62A4\u8FDB\u7A0B</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">systemctl daemon-reload</span></span>
<span class="line"><span style="color:#D4D4D4;">\u91CD\u65B0\u542F\u52A8\u591A\u7EF4\u6570\u636E\u96C6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u6B65\u9AA4\u4E09</strong> \u91CD\u542F<code>Kubelet</code></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">systemctl restart kubelet</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u73B0\u5728\uFF0C\u5F53\u524D\u8282\u70B9\u7684<code>Kubelet</code>\u5DE5\u4F5C\u8DEF\u5F84\u5DF2\u66F4\u6539\u4E3A<code>/home/k8s/kubelet</code>.</p>`,33);function v(k,y){const a=r("RouterLink");return c(),d("div",null,[p,s("p",null,[e("\u53C2\u8003"),n(a,{to:"/zh/reference/kubernetes/installer/minikube.html"},{default:l(()=>[e("\u5B89\u88C5Minikube\u96C6\u7FA4")]),_:1}),e("\u3002")]),u,b,s("p",null,[e("\u53C2\u8003"),n(a,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html"},{default:l(()=>[e("\u5B89\u88C5Kubernetes\u96C6\u7FA4")]),_:1}),e("\u3002")]),h,D,s("p",null,[e("\u53C2\u8003"),n(a,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster-ha.html"},{default:l(()=>[e("\u5B89\u88C5Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4")]),_:1}),e("\u3002")]),m])}const g=i(t,[["render",v],["__file","installer-config.html.vue"]]);export{g as default};
