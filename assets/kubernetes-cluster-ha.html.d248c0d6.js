import{_ as r,r as c,o as p,c as o,a as e,b as s,d as a,w as l,e as i}from"./app.66298e46.js";const d="/images/reference/kubernetes/architecture-ha-k8s-cluster.png",t={},D=i('<h1 id="kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4" aria-hidden="true">#</a> Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4</h1><p>\u9AD8\u53EF\u7528K8S\u96C6\u7FA4\u662F\u6307K8S\u7684Master\u8282\u70B9\u4E2A\u6570\u4E0D\u5C11\u4E8E3\u4E2A\uFF0CK8S\u7BA1\u7406\u9762\u6BCF\u4E2A\u7EC4\u4EF6\u526F\u672C\u6570\u4E0D\u5C11\u4E8E3\u4E2A\u7684Kubernetes\u96C6\u7FA4\u3002</p><h2 id="\u6574\u4F53\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u6574\u4F53\u67B6\u6784" aria-hidden="true">#</a> \u6574\u4F53\u67B6\u6784</h2><p><img src="'+d+'" alt="Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4\u6574\u4F53\u67B6\u6784"></p><h2 id="\u73AF\u5883\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u4FE1\u606F" aria-hidden="true">#</a> \u73AF\u5883\u4FE1\u606F</h2><ul><li><p>Master\u8282\u70B9\uFF1A</p><ul><li>192.168.100.13 cnserver20</li><li>192.168.100.14 cnserver21</li><li>192.168.100.15 cnserver22</li></ul></li><li><p>Worker\u8282\u70B9\uFF1A</p><ul><li>192.168.100.10 cnserver17</li><li>192.168.100.11 cnserver18</li><li>192.168.100.12 cnserver19</li></ul></li><li><p>\u865A\u62DFip:</p><ul><li>kubernetes-vip\uFF1A192.168.100.99</li></ul></li></ul><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p><code>kubernetes-vip</code>\u7528\u4E8EKeepalived\u7684\u865A\u62DFvip\u914D\u7F6E\uFF0C\u4E0E\u673A\u5668\u5728\u540C\u4E00\u7F51\u6BB5\uFF0C\u4F7F\u7528\u540C\u4E00\u7F51\u5361</p></div><h2 id="\u914D\u7F6E\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u670D\u52A1\u5668" aria-hidden="true">#</a> \u914D\u7F6E\u670D\u52A1\u5668</h2><h3 id="\u57FA\u7840\u73AF\u5883\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840\u73AF\u5883\u914D\u7F6E" aria-hidden="true">#</a> \u57FA\u7840\u73AF\u5883\u914D\u7F6E</h3>',9),u=i(`<h3 id="\u914D\u7F6E-etc-hosts" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-etc-hosts" aria-hidden="true">#</a> \u914D\u7F6E/etc/hosts</h3><p>\u914D\u7F6E/etc/hosts\u975E\u5FC5\u8981\u64CD\u4F5C\uFF0C\u8BE5\u914D\u7F6E\u662F\u4E3A\u4E86\u4FBF\u4E8E\u540E\u7EED\u76F4\u63A5\u901A\u8FC7\u4E3B\u673A\u540D\u79F0/vip\u540D\u79F0\u8FDB\u884C\u64CD\u4F5C\uFF0C\u5982\u4E0D\u914D\u7F6E\uFF0C\u540E\u7EED\u64CD\u4F5C\u4E2D\u7684\u57DF\u4E3B\u673A\u540D\u79F0/vip\u540D\u79F0\u9700\u8981\u66FF\u6362\u6210\u76F8\u5E94ip.</p><p>\u914D\u7F6E\u65B9\u5F0F\u4E3A\u5728\u6240\u6709\u8282\u70B9\u7684<code>/etc/hosts</code>\u6587\u4EF6\u4E2D\u6DFB\u52A0\u8282\u70B9\u4FE1\u606F\u548Cvip\u4FE1\u606F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">192.168.100.10 cnserver17</span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.11 cnserver18</span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.12 cnserver19</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.13 cnserver20</span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.14 cnserver21</span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.15 cnserver22</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">192.168.100.99 kubernetes-vip</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B89\u88C5keepalived" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5keepalived" aria-hidden="true">#</a> \u5B89\u88C5Keepalived</h2><p>Keepalived\u662F\u4E00\u79CD\u9AD8\u53EF\u7528\u65B9\u6848\uFF0C\u901A\u8FC7VIP(\u865A\u62DFIP)\u548C\u5FC3\u8DF3\u68C0\u6D4B\u6765\u5B9E\u73B0\u9AD8\u53EF\u7528\u3002</p><p>Keepalived\u901A\u5E38\u6709Master\u548CBackup\u4E24\u4E2A\u89D2\u8272\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u67091\u4E2Amaster\u548C\u591A\u4E2Abackup.</p><p>Master\u4F1A\u7ED1\u5B9AVIP\u5230\u81EA\u5DF1\u7F51\u5361\u4E0A\uFF0C\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u3002</p><p>Master\u548CBackup\u4F1A\u5B9A\u65F6\u786E\u5B9A\u5BF9\u65B9\u72B6\u6001\uFF0C\u5F53Master\u4E0D\u53EF\u7528\u7684\u65F6\u5019\uFF0CBackup\u4F1A\u901A\u77E5\u7F51\u5173\uFF0C\u5E76\u628AVIP\u7ED1\u5B9A\u5230\u81EA\u5DF1\u7684\u7F51\u5361\u4E0A\uFF0C\u5B9E\u73B0\u670D\u52A1\u4E0D\u4E2D\u65AD\uFF0C\u5373\u4E3A\u9AD8\u53EF\u7528\u3002</p><h3 id="\u73AF\u5883\u4FE1\u606F-1" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u4FE1\u606F-1" aria-hidden="true">#</a> \u73AF\u5883\u4FE1\u606F</h3><p>\u642D\u5EFAKeepalied\u7684\u673A\u5668(Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4\u7684Master\u8282\u70B9)\uFF1A</p><ul><li>192.168.100.13 cnserver20</li><li>192.168.100.14 cnserver21</li><li>192.168.100.15 cnserver22</li></ul><h3 id="keepalived\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#keepalived\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> Keepalived\u914D\u7F6E\u6587\u4EF6</h3><p>\u5728\u6BCF\u4E2A\u8282\u70B9\u4E0A\u914D\u7F6E\u76F8\u5E94\u7684keepalived.conf\uFF0C\u89C1\u9644\u4EF6<a href="/downloads/Keepalived%E9%85%8D%E7%BD%AE.zip">Keepalived\u914D\u7F6E</a>\u3002</p><p>\u914D\u7F6E\u6587\u4EF6\u4E2D\u9700\u8981\u4FEE\u6539\u7684\u6709\u5982\u4E0B\u90E8\u5206\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">\u2026\u2026</span></span>
<span class="line"><span style="color:#D4D4D4;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#D4D4D4;">  interface em3 # \u6B64\u5904\u901A\u8FC7ip addr\u547D\u4EE4\u6839\u636E\u5B9E\u9645\u586B\u5199\uFF0C\u672C\u673Aip\u6240\u5728\u7F51\u5361</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">  state BACKUP# \u4E00\u53F0\u8282\u70B9\u914D\u7F6E\u4E3AMASTER\uFF0C\u5176\u4ED6\u8282\u70B9\u914D\u7F6E\u4E3ABACKUP</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">  unicast_src_ip 192.168.100.15  #\u8BBE\u7F6E\u672C\u673A\u5185\u7F51ip</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span></span>
<span class="line"><span style="color:#D4D4D4;">  #\u5176\u4ED6\u4E24\u53F0master ip</span></span>
<span class="line"><span style="color:#D4D4D4;">  unicast_peer {</span></span>
<span class="line"><span style="color:#D4D4D4;">        192.168.100.13</span></span>
<span class="line"><span style="color:#D4D4D4;">        192.168.100.14</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">  virtual_ipaddress {</span></span>
<span class="line"><span style="color:#D4D4D4;">    192.168.100.99  # vip \u865A\u62DFip</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"><span style="color:#D4D4D4;">\u2026\u2026</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5BB9\u5668\u542F\u52A8keepalived" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u542F\u52A8keepalived" aria-hidden="true">#</a> \u5BB9\u5668\u542F\u52A8Keepalived</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;"># $keepalivedConfPath: keepalived.conf\u6587\u4EF6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#D4D4D4;">docker run \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --name=keepalived \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --cap-add=NET_ADMIN \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --cap-add=NET_BROADCAST \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --cap-add=NET_RAW \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --net=host \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --restart=always \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --volume </span><span style="color:#9CDCFE;">$keepalivedConfPath</span><span style="color:#D4D4D4;">:/container/service/keepalived/assets/keepalived.conf \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    -d osixia/keepalived:2.0.20 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --copy-service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B89\u88C5haproxy" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5haproxy" aria-hidden="true">#</a> \u5B89\u88C5HAProxy</h2><p>HAProxy \u662F\u4E00\u6B3E\u63D0\u4F9B\u9AD8\u53EF\u7528\u6027\u3001\u8D1F\u8F7D\u5747\u8861\u4EE5\u53CA\u57FA\u4E8ETCP\uFF08\u7B2C\u56DB\u5C42\uFF09\u548CHTTP\uFF08\u7B2C\u4E03\u5C42\uFF09\u5E94\u7528\u7684\u4EE3\u7406\u8F6F\u4EF6\u3002</p><p>HAProxy\u4F5C\u4E3A\u8D1F\u8F7D\u5747\u8861\u65F6\uFF0C\u53EF\u4EE5\u6309\u7167\u6307\u5B9A\u7B56\u7565\uFF08\u6BD4\u5982\u8F6E\u8BE2\uFF09\u5C06\u6D41\u91CF\u8F6C\u53D1\u5230\u76F8\u5E94\u670D\u52A1\u4E2D\u3002</p><p>\u4F8B\u5982\u5F53\u524DServer\u6709\u4E09\u4E2A\u526F\u672C\u7531HAProxy\u8FDB\u884C\u8D1F\u8F7D\u5747\u8861\uFF0CHAProxy\u53EF\u5C06\u5BA2\u6237\u7AEF\u5BF9Server\u7684\u8BBF\u95EE\u8BF7\u6C42\u8DEF\u7531\u5230\u8FD9\u4E09\u4E2A\u526F\u672C\u4E2D\u7684\u4E00\u4E2A\u3002\u8FD9\u6837\u505A\u6709\u4EE5\u4E0B\u597D\u5904\uFF1A</p><ul><li>\u907F\u514D\u6240\u6709\u8BF7\u6C42\u96C6\u4E2D\u8F6C\u53D1\u5230\u67D0\u4E2Aserver\uFF0C\u6709\u6548\u964D\u4F4E\u5355\u4E2A\u670D\u52A1\u7EC4\u4EF6\u7684\u538B\u529B;</li><li>\u5F53\u67D0\u4E2Aserver\u526F\u672C\u5B95\u673A\uFF0CHAProxy\u53EF\u5C06\u6D41\u91CF\u8F6C\u53D1\u5230\u5065\u5EB7\u7684server\u7AEF\uFF0C\u4ECE\u800C\u4FDD\u8BC1\u670D\u52A1\u7684\u9AD8\u53EF\u7528\u3002</li></ul><h3 id="\u73AF\u5883\u4FE1\u606F-2" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u4FE1\u606F-2" aria-hidden="true">#</a> \u73AF\u5883\u4FE1\u606F</h3><p>\u642D\u5EFAHAProxy\u7684\u673A\u5668(Kubernetes\u9AD8\u53EF\u7528\u96C6\u7FA4\u7684Master\u8282\u70B9)\uFF1A</p><ul><li>192.168.100.13 cnserver20</li><li>192.168.100.14 cnserver21</li><li>192.168.100.15 cnserver22</li></ul><h3 id="haproxy\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#haproxy\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> HAProxy\u914D\u7F6E\u6587\u4EF6</h3><p>\u5728\u6BCF\u4E2A\u8282\u70B9\u4E0A\u914D\u7F6E<code>haproxy.cfg</code>\uFF0C\u89C1\u9644\u4EF6<a href="/downloads/haproxy.cfg">HAProxy\u914D\u7F6E</a>\u3002</p><p>\u5176\u4E2D\uFF0C\u4E3B\u8981\u7684\u8D1F\u8F7D\u76F8\u5173\u914D\u7F6E\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">\u2026\u2026</span></span>
<span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;"># main frontend which proxys to the backends</span></span>
<span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;">frontend  kubernetes-apiserver</span></span>
<span class="line"><span style="color:#D4D4D4;">    mode tcp</span></span>
<span class="line"><span style="color:#D4D4D4;">    bind *:9443  ## \u76D1\u542C9443\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#D4D4D4;">    # bind *:443 ssl # To be completed ....</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">    acl url_static       path_beg       -i /static /images /javascript /stylesheets</span></span>
<span class="line"><span style="color:#D4D4D4;">    acl url_static       path_end       -i .jpg .gif .png .css .js</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">    default_backend             kubernetes-apiserver</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span>
<span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;"># round robin balancing between the various backends</span></span>
<span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;">backend kubernetes-apiserver</span></span>
<span class="line"><span style="color:#D4D4D4;">    mode        tcp  # \u6A21\u5F0Ftcp</span></span>
<span class="line"><span style="color:#D4D4D4;">    balance     roundrobin  # \u91C7\u7528\u8F6E\u8BE2\u7684\u8D1F\u8F7D\u7B97\u6CD5</span></span>
<span class="line"><span style="color:#D4D4D4;"># k8s-apiservers backend  # \u914D\u7F6Eapiserver\uFF0C\u7AEF\u53E36443</span></span>
<span class="line"><span style="color:#D4D4D4;"> server cnserver20 192.168.100.13:6443 check</span></span>
<span class="line"><span style="color:#D4D4D4;"> server cnserver21 192.168.100.14:6443 check</span></span>
<span class="line"><span style="color:#D4D4D4;"> server cnserver22 192.168.100.15:6443 check</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u51C6\u5907socket\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u51C6\u5907socket\u6587\u4EF6" aria-hidden="true">#</a> \u51C6\u5907socket\u6587\u4EF6</h3><p>\u51C6\u5907\u4E00\u4E2A\u7A7A\u7684\u6587\u4EF6\u5939\u8DEF\u5F84<code>$statsDirPath</code>\u7528\u4E8Ehaproxy\u6301\u4E45\u5316stats\u6587\u4EF6\u3002</p><h3 id="\u5BB9\u5668\u542F\u52A8haproxy" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u542F\u52A8haproxy" aria-hidden="true">#</a> \u5BB9\u5668\u542F\u52A8HAProxy</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;"># $haproxyConfDirPath: haproxy.conf\u6587\u4EF6\u6240\u5728\u6587\u4EF6\u5939\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#6A9955;"># $statsDirPath: \u7528\u4E8Ehaproxy\u6301\u4E45\u5316stats\u6587\u4EF6\u7684\u6587\u4EF6\u5939\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#D4D4D4;">docker run \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --name=haproxy \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --net=host \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --restart=always \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --volume </span><span style="color:#9CDCFE;">$haproxyConfDirPath</span><span style="color:#D4D4D4;">:/usr/local/etc/haproxy:ro \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    --volume </span><span style="color:#9CDCFE;">$statsDirPath</span><span style="color:#D4D4D4;">:/var/lib/haproxy \\</span></span>
<span class="line"><span style="color:#D4D4D4;">    -d haproxy:2.3.6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u67E5\u770Bhaproxy\u76D1\u63A7" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770Bhaproxy\u76D1\u63A7" aria-hidden="true">#</a> \u67E5\u770BHAProxy\u76D1\u63A7</h3><p>\u5728\u914D\u7F6E\u6587\u4EF6<code>haproxy.cfg</code>\u4E2D\u5B9A\u4E49\u4E86HAProxy\u7684\u76D1\u63A7\u914D\u7F6E\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;"># haproxy monitor</span></span>
<span class="line"><span style="color:#D4D4D4;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#D4D4D4;">listen admin_stats</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   enable</span></span>
<span class="line"><span style="color:#D4D4D4;">        bind    *:9445    #\u76D1\u542C\u7684ip\u7AEF\u53E3\u53F7</span></span>
<span class="line"><span style="color:#D4D4D4;">        mode    http    #\u5F00\u5173</span></span>
<span class="line"><span style="color:#D4D4D4;">        option  httplog</span></span>
<span class="line"><span style="color:#D4D4D4;">        log     global</span></span>
<span class="line"><span style="color:#D4D4D4;">        maxconn 10</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   refresh 30s   #\u7EDF\u8BA1\u9875\u9762\u81EA\u52A8\u5237\u65B0\u65F6\u95F4</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   uri /haproxy#\u8BBF\u95EE\u7684uri   ip:9445/haproxy</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   realm haproxy</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   auth admin:admin  #\u8BA4\u8BC1\u7528\u6237\u540D\u548C\u5BC6\u7801</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   hide-version   #\u9690\u85CFHAProxy\u7684\u7248\u672C\u53F7</span></span>
<span class="line"><span style="color:#D4D4D4;">        stats   admin if TRUE   #\u7BA1\u7406\u754C\u9762\uFF0C\u5982\u679C\u8BA4\u8BC1\u6210\u529F\u4E86\uFF0C\u53EF\u901A\u8FC7webui\u7BA1\u7406\u8282\u70B9</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BB9\u5668\u542F\u52A8\u4E4B\u540E\u53EF\u4EE5\u5728web\u4E0A\u8BBF\u95EE\u6765\u67E5\u770Bhaproxy\u7684\u76D1\u63A7\u4FE1\u606F\uFF0C\u8BBF\u95EE\u5730\u5740\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;"># $ip: \u7531\u4E8E\u5BB9\u5668\u542F\u52A8\u547D\u4EE4\u4E2D\u5236\u5B9A\u4E86--net=host\uFF0C\u56E0\u6B64\u6B64\u5904\u7684$ip\u6307HAProxy\u8FD0\u884C\u7684\u4E3B\u673A\u7684ip</span></span>
<span class="line"><span style="color:#D4D4D4;"># \u767B\u5F55\u7528\u6237\u540D\u5BC6\u7801\u4E3A\u914D\u7F6E\u4E2D\u7684\`stats auth\`\u6307\u5B9A\uFF0C\u5747\u4E3Aadmin</span></span>
<span class="line"><span style="color:#D4D4D4;">http://$ip:9445/haproxy</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B89\u88C5master\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5master\u8282\u70B9" aria-hidden="true">#</a> \u5B89\u88C5Master\u8282\u70B9</h2><p>\u6B64\u5904\u9009\u62E9\u5148\u5B89\u88C5Master\u8282\u70B9<code>192.168.100.13 cnserver20</code>\uFF0C\u4ECE\u800C\u5B8C\u6210\u9AD8\u53EF\u7528Kubernetes\u96C6\u7FA4\u7684\u521D\u59CB\u5316\u3002</p><h3 id="\u51C6\u5907kubeadm\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u51C6\u5907kubeadm\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u51C6\u5907Kubeadm\u914D\u7F6E\u6587\u4EF6</h3><p>Kubeadm\u7684\u914D\u7F6E\u6587\u4EF6<code>kubeadm.yaml</code>\u5185\u5BB9\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="color:#D4D4D4;">kind: ClusterConfiguration</span></span>
<span class="line"><span style="color:#D4D4D4;">kubernetesVersion: v1.23.1</span></span>
<span class="line"><span style="color:#D4D4D4;">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span></span>
<span class="line"><span style="color:#D4D4D4;">controlPlaneEndpoint: &quot;kubernetes-vip:9443&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">networking:</span></span>
<span class="line"><span style="color:#D4D4D4;">  dnsDomain: cluster.local</span></span>
<span class="line"><span style="color:#D4D4D4;">  podSubnet: 10.244.0.0/16</span></span>
<span class="line"><span style="color:#D4D4D4;">  serviceSubnet: 10.211.0.0/12</span></span>
<span class="line"><span style="color:#D4D4D4;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><ul><li><code>kubernetes-vip</code>\u4E3A<code>/etc/hosts</code>\u6587\u4EF6\u4E2D\u914D\u7F6EKeepalived\u865A\u62DFIP\u57DF\u540D\uFF0C\u8BE6\u89C1<a href="#%E9%85%8D%E7%BD%AEetchosts">\u914D\u7F6E/etc/hosts</a>.</li><li>\u6B64\u5904\u4F7F\u7528<code>Flannel</code>\u4F5C\u4E3A\u7F51\u7EDC\u7EC4\u4EF6,\u5BF9\u5E94\u7684&quot;podSubnet&quot;\u4E3A<code>10.244.0.0/16</code>\uFF1B</li><li>\u82E5\u4F7F\u7528<code>Calico</code>\u4F5C\u4E3A\u7F51\u7EDC\u7EC4\u4EF6,\u5BF9\u5E94\u7684&quot;podSubnet&quot;\u4E3A<code>192.168.0.0/16</code>.</li></ul></div><h3 id="\u6267\u884C\u521D\u59CB\u5316\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u521D\u59CB\u5316\u6307\u4EE4" aria-hidden="true">#</a> \u6267\u884C\u521D\u59CB\u5316\u6307\u4EE4</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubeadm init --config kubeadm.yaml --upload-certs</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u5982\u679C\u6B64\u524D\u6267\u884C\u8FC7\u4EE5\u4E0A\u811A\u672C\u6216\u8005<code>Kubeadm</code>\u5B89\u88C5\u6307\u4EE4\uFF0C\u5219\u5E94\u5728\u6267\u884C\u4EE5\u4E0A\u811A\u672C\u4E4B\u524D\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubeadm reset</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>\u521D\u59CB\u5316\u5B8C\u6210\u540E\uFF0C\u5C06\u6253\u5370\u5982\u4E0B\u6D88\u606F\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">Your Kubernetes control-plane has initialized successfully!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">To start using your cluster, you need to run the following as a regular user:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  mkdir -p </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube</span></span>
<span class="line"><span style="color:#D4D4D4;">  sudo cp -i /etc/kubernetes/admin.conf </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube/config</span></span>
<span class="line"><span style="color:#D4D4D4;">  sudo chown </span><span style="color:#CE9178;">$(id -u)</span><span style="color:#D4D4D4;">:</span><span style="color:#CE9178;">$(id -g)</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">$HOME</span><span style="color:#D4D4D4;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">Alternatively, </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> you are the root user, you can run:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">export</span><span style="color:#D4D4D4;"> KUBECONFIG=/etc/kubernetes/admin.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">You should now deploy a pod network to the cluster.</span></span>
<span class="line"><span style="color:#D4D4D4;">Run </span><span style="color:#CE9178;">&quot;kubectl apply -f [podnetwork].yaml&quot;</span><span style="color:#D4D4D4;"> with one of the options listed at:</span></span>
<span class="line"><span style="color:#D4D4D4;">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">You can now join any number of the control-plane node running the following </span><span style="color:#DCDCAA;">command</span><span style="color:#D4D4D4;"> on each as root:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  kubeadm join kubernetes-vip:9443 --token grv9o6.75venx9x7sajjowp \\</span></span>
<span class="line"><span style="color:#D4D4D4;">        --discovery-token-ca-cert-hash sha256:ea92e650eed7e5df76ab99ac545f61713d3f1ff9001a3281a1f5c71ece7309a5 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">        --control-plane --certificate-key 1e610197e25fbb02e695db6124f21874ff865044cd17b2a3fe5ca73b0d8a791c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">Please note that the certificate-key gives access to cluster sensitive data, keep it secret!</span></span>
<span class="line"><span style="color:#D4D4D4;">As a safeguard, uploaded-certs will be deleted </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> two hours; If necessary, you can use</span></span>
<span class="line"><span style="color:#CE9178;">&quot;kubeadm init phase upload-certs --upload-certs&quot;</span><span style="color:#D4D4D4;"> to reload certs afterward.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">Then you can join any number of worker nodes by running the following on each as root:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">kubeadm join kubernetes-vip:9443 --token grv9o6.75venx9x7sajjowp \\</span></span>
<span class="line"><span style="color:#D4D4D4;">        --discovery-token-ca-cert-hash sha256:ea92e650eed7e5df76ab99ac545f61713d3f1ff9001a3281a1f5c71ece7309a5</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u914D\u7F6Ekubeconfig" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6Ekubeconfig" aria-hidden="true">#</a> \u914D\u7F6EKubeconfig</h3>`,51),v=e("h3",{id:"\u5B89\u88C5kubernetes\u7F51\u7EDC\u7EC4\u4EF6",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u5B89\u88C5kubernetes\u7F51\u7EDC\u7EC4\u4EF6","aria-hidden":"true"},"#"),s(" \u5B89\u88C5Kubernetes\u7F51\u7EDC\u7EC4\u4EF6")],-1),b=e("h2",{id:"\u67E5\u770B\u96C6\u7FA4\u4FE1\u606F",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u67E5\u770B\u96C6\u7FA4\u4FE1\u606F","aria-hidden":"true"},"#"),s(" \u67E5\u770B\u96C6\u7FA4\u4FE1\u606F")],-1),h=i(`<h2 id="\u6DFB\u52A0master\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0master\u8282\u70B9" aria-hidden="true">#</a> \u6DFB\u52A0Master\u8282\u70B9</h2><p>\u96C6\u7FA4\u521D\u59CB\u5316\u5B8C\u6210\u540E\u6253\u5370\u51FA\u7684\u4FE1\u606F\u4E2D\u542B\u6709<code>--control-plane</code>\u53C2\u6570\u7684\u6307\u4EE4\u53EF\u7528\u4E8E\u6DFB\u52A0<code>Master</code>\u8282\u70B9\u3002</p><p>\u5728\u9700\u8981\u4F5C\u4E3AMaster\u8282\u70B9\u6DFB\u52A0\u5230\u96C6\u7FA4\u4E2D\u7684\u8282\u70B9\u4E0A\u6267\u884C:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">kubeadm join kubernetes-vip:9443 --token grv9o6.75venx9x7sajjowp \\</span></span>
<span class="line"><span style="color:#D4D4D4;">      --discovery-token-ca-cert-hash sha256:ea92e650eed7e5df76ab99ac545f61713d3f1ff9001a3281a1f5c71ece7309a5 \\</span></span>
<span class="line"><span style="color:#D4D4D4;">      --control-plane --certificate-key 1e610197e25fbb02e695db6124f21874ff865044cd17b2a3fe5ca73b0d8a791c</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),m={class:"custom-container tip"},y=e("p",{class:"custom-container-title"},"\u63D0\u793A",-1),k=e("code",null,"Kubeconfig",-1),f=e("h2",{id:"\u6DFB\u52A0worker\u8282\u70B9",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u6DFB\u52A0worker\u8282\u70B9","aria-hidden":"true"},"#"),s(" \u6DFB\u52A0Worker\u8282\u70B9")],-1),E=e("p",null,[s("\u96C6\u7FA4\u521D\u59CB\u5316\u5B8C\u6210\u540E\u6253\u5370\u51FA\u7684\u4FE1\u606F\u4E2D\u4E0D\u542B\u6709"),e("code",null,"--control-plane"),s("\u53C2\u6570\u7684\u6307\u4EE4\u53EF\u7528\u4E8E\u6DFB\u52A0"),e("code",null,"Worker"),s("\u8282\u70B9\u3002")],-1),x=e("h2",{id:"\u5378\u8F7Dkubernetes\u96C6\u7FA4",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u5378\u8F7Dkubernetes\u96C6\u7FA4","aria-hidden":"true"},"#"),s(" \u5378\u8F7DKubernetes\u96C6\u7FA4")],-1);function g(_,A){const n=c("RouterLink");return p(),o("div",null,[D,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u914D\u7F6E\u670D\u52A1\u5668")]),_:1}),s("\u3002")]),u,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E9%85%8D%E7%BD%AEkubeconfig"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u914D\u7F6EKubeconfig")]),_:1}),s(".")]),v,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E5%AE%89%E8%A3%85kubernetes%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u5B89\u88C5Kubernetes\u7F51\u7EDC\u7EC4\u4EF6")]),_:1}),s("\u3002")]),b,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E4%BF%A1%E6%81%AF"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u67E5\u770B\u96C6\u7FA4\u4FE1\u606F")]),_:1}),s("\u3002")]),h,e("div",m,[y,e("ul",null,[e("li",null,[s("Kubeadm\u66F4\u591A\u53C2\u6570\u53C2\u8003"),a(n,{to:"/zh/reference/tools/kubeadm.html#%E5%8F%82%E6%95%B0"},{default:l(()=>[s("Kubeadm\u53C2\u6570")]),_:1}),s(";")]),e("li",null,[s("\u82E5Token\u5DF2\u8FC7\u671F\uFF0C\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer-config.html#%E9%87%8D%E6%96%B0%E7%94%9F%E6%88%90%E5%A2%9E%E5%8A%A0%E8%8A%82%E7%82%B9%E7%9A%84token"},{default:l(()=>[s("\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684Token")]),_:1}),s(";")]),e("li",null,[s("\u82E5Certificate\u5DF2\u8FC7\u671F\uFF0C\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer-config.html#%E9%87%8D%E6%96%B0%E7%94%9F%E6%88%90%E5%A2%9E%E5%8A%A0%E8%8A%82%E7%82%B9%E7%9A%84certificate"},{default:l(()=>[s("\u91CD\u65B0\u751F\u6210\u589E\u52A0\u8282\u70B9\u7684Certificate")]),_:1}),s(";")]),e("li",null,[s("\u6DFB\u52A0Master\u8282\u70B9\u4E4B\u540E\uFF0C\u4EA6\u9700\u8981\u914D\u7F6E"),k,s("\uFF0C\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer-config.html#%E9%85%8D%E7%BD%AEkubeconfig"},{default:l(()=>[s("\u914D\u7F6EKubeconfig")]),_:1}),s(".")])])]),f,E,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E6%B7%BB%E5%8A%A0worker%E8%8A%82%E7%82%B9"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u6DFB\u52A0Worker\u8282\u70B9")]),_:1}),s("\u3002")]),x,e("p",null,[s("\u53C2\u8003"),a(n,{to:"/zh/reference/kubernetes/installer/kubernetes-cluster.html#%E5%8D%B8%E8%BD%BDkubernetes%E9%9B%86%E7%BE%A4"},{default:l(()=>[s("Kubernetes\u96C6\u7FA4-\u5378\u8F7DKubernetes\u96C6\u7FA4")]),_:1}),s("\u3002")])])}const K=r(t,[["render",g],["__file","kubernetes-cluster-ha.html.vue"]]);export{K as default};
